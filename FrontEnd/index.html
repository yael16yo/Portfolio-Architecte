<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<title>Sophie Bluel - Architecte d'intérieur</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Work+Sans&display=swap" rel="stylesheet">
	<meta name="description" content="">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
        integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
	<link rel="stylesheet" href="./assets/style.css">
</head>
<body>
<div id="outputUserHeader_id"></div>
<div class="max-width-and-container">

<div id="modalModify" class="modal">
	<div class="modal-content">

		<span class="return" id="backButton"><i class="fa fa-arrow-left"></i></span>
		<span class="close"><i class="fa fa-close fa-lg"></i></span>

		<div class="containerDynamicDiv">

			<div id="dynamicDivDeletePhotos">
				<h3 class="titleInsideModal">Galerie photo</h3>
				<div id="divForGallery" class="photosGalleryDelete"></div>
			</div>
			<button type="button" class="btnAddPhotos" id="addPhotosButton">Ajouter une photo</button>

			<div id="dynamicDivAddPhotos">
				<h3 class="titleInsideModal">Ajout photo</h3>
				<div id="divForAddingPhotos" class="photosGalleryAdd">
					<form action="" method="POST" enctype="multipart/form-data" class="formInputAdd" id="formAddId">
						<label for="inputImage" class="labelInputImage">
							<div id="dynamicSpanChange">
								<svg width="76" height="76" viewBox="0 0 76 76" fill="none" xmlns="http://www.w3.org/2000/svg">
									<path d="M63.5517 15.8879C64.7228 15.8879 65.681 16.8461 65.681 18.0172V60.5768L65.0156 59.7118L46.9165 36.2894C46.3176 35.5042 45.3727 35.0517 44.3879 35.0517C43.4031 35.0517 42.4715 35.5042 41.8594 36.2894L30.8136 50.5824L26.7546 44.8998C26.1557 44.0614 25.1975 43.569 24.1595 43.569C23.1214 43.569 22.1632 44.0614 21.5644 44.9131L10.9178 59.8183L10.319 60.6434V60.6034V18.0172C10.319 16.8461 11.2772 15.8879 12.4483 15.8879H63.5517ZM12.4483 9.5C7.75048 9.5 3.93103 13.3195 3.93103 18.0172V60.6034C3.93103 65.3012 7.75048 69.1207 12.4483 69.1207H63.5517C68.2495 69.1207 72.069 65.3012 72.069 60.6034V18.0172C72.069 13.3195 68.2495 9.5 63.5517 9.5H12.4483ZM23.0948 35.0517C23.9337 35.0517 24.7644 34.8865 25.5394 34.5655C26.3144 34.2444 27.0186 33.7739 27.6118 33.1807C28.2049 32.5876 28.6755 31.8834 28.9965 31.1083C29.3175 30.3333 29.4828 29.5027 29.4828 28.6638C29.4828 27.8249 29.3175 26.9943 28.9965 26.2192C28.6755 25.4442 28.2049 24.74 27.6118 24.1468C27.0186 23.5537 26.3144 23.0831 25.5394 22.7621C24.7644 22.4411 23.9337 22.2759 23.0948 22.2759C22.2559 22.2759 21.4253 22.4411 20.6503 22.7621C19.8752 23.0831 19.171 23.5537 18.5779 24.1468C17.9847 24.74 17.5142 25.4442 17.1931 26.2192C16.8721 26.9943 16.7069 27.8249 16.7069 28.6638C16.7069 29.5027 16.8721 30.3333 17.1931 31.1083C17.5142 31.8834 17.9847 32.5876 18.5779 33.1807C19.171 33.7739 19.8752 34.2444 20.6503 34.5655C21.4253 34.8865 22.2559 35.0517 23.0948 35.0517Z" fill="#B9C5CC"/>
								</svg>
								<span>+ Ajouter photo</span>
								<p>jpg, png : 4mo max</p>
							</div>
							<div id="dynamicImagePreview">
								<img src="#" alt="Image preview" id="image">
							</div>
						</label>
						<input type="file" id="inputImage" name="inputImageName" accept="image/png, image/jpeg" size="4194304" onchange="previewPicture(this)" required >
						
						<label for="inputTitle">Titre</label>
						<input type="text" id="inputTitle" required name="inputTitleName">
						
						<label for="inputCategory">Catégorie</label>
						<select name="categories" id="inputCategory" required name="inputCategoryName">
							<option value=""></option>
							<option value="1">Objets</option>
							<option value="2">Appartements</option>
							<option value="3">Hotels & restaurants</option>
						</select>
						<button type="submit" class="validateButton" id="validateButton">Valider</button>
					</form>
				</div>
			</div>
			
		</div>
	</div>
</div>

<header>
	<h1>Sophie Bluel <span>Architecte d'intérieur</span></h1>
	<nav>
		<ul id="linkNavContainer">
			<li><a href="index.html" class="linkNav active-li">projets</a></li>
			<li><a href="index.html#contact" class="linkNav">contact</a></li>
			<li><a href="login.html" class="linkNav">login</a></li>
			<li><a href="#"><img src="./assets/icons/instagram.png" alt="Instagram"></a></li>
		</ul>
	</nav>
</header>
<main>
	<section id="introduction">
		<figure>
			<img src="./assets/images/sophie-bluel.png" alt="">
		</figure>
		<article>
			<h2>Designer d'espace</h2>
			<p>Je raconte votre histoire, je valorise vos idées. Je vous accompagne de la conception à la livraison finale du chantier.</p>
			<p>Chaque projet sera étudié en commun, de façon à mettre en valeur les volumes, les matières et les couleurs dans le respect de l’esprit des lieux et le choix adapté des matériaux. Le suivi du chantier sera assuré dans le souci du détail, le respect du planning et du budget.</p>
			<p>En cas de besoin, une équipe pluridisciplinaire peut-être constituée : architecte DPLG, décorateur(trice)</p>
		</article>
	</section>
	<section id="portfolio">
		<h2>Mes Projets <span id="modifierBtnId"></span></h2>

			<div class="container-filters" id="filters"></div>

			<div class="gallery" id="items"></div>

	</section>

	<section id="contact" class="form-type">
		<h2>Contact</h2>
		<p>Vous avez un projet ? Discutons-en !</p>
		<form action="#" method="post">
			<label for="name">Nom</label>
			<input type="text" name="name" id="name">
			<label for="email">Email</label>
			<input type="email" name="email" id="email">
			<label for="message">Message</label>
			<textarea name="message" id="message" cols="30" rows="10"></textarea>
			<input type="submit" value="Envoyer">
		</form>
	</section>
</main>
</div>

<footer>
	<nav>
		<ul>
			<li><a href="#">Mentions Légales</a></li>
		</ul>
	</nav>
</footer>
<script>

	const apiUrlFilters = "http://localhost:5678/api/categories";
	const apiUrlWorks = "http://localhost:5678/api/works";

	let	tokenUserDelete = sessionStorage.getItem('token');
	let validateButton = document.getElementById("validateButton");
	let dynamicDivDeletePhotos = document.getElementById("dynamicDivDeletePhotos");
	let dynamicDivAddPhotos = document.getElementById("dynamicDivAddPhotos");
	let addPhotosButton = document.getElementById("addPhotosButton");
	let backButton = document.getElementById("backButton");

	let image = document.getElementById("image");
	let dynamicSpanChange = document.getElementById("dynamicSpanChange");
	let formAdd = document.getElementById("formAddId");
     

    let previewPicture  = function (e) {
        const [picture] = e.files
        if (picture) {
            image.src = URL.createObjectURL(picture);
			dynamicSpanChange.style.display = "none";
			dynamicImagePreview.style.display = "flex";
        }
    } 



	formAdd.addEventListener('submit', function(e) {
		e.preventDefault();

			let inputTitle = document.getElementById("inputTitle");
			let inputImage = document.getElementById("inputImage");
			let inputCategory = document.getElementById("inputCategory");
			let inputTitleValue = inputTitle.value;
			let inputImageValue = inputImage.value;
			let inputCategoryValue = inputCategory.value;
			
			/*let re = /(?:\.([^.]+))?$/;
			let extensionImage = re.exec(inputImageValue)[1];*/

				let file = inputImage.files[0];

				const formData = new FormData();

				formData.append("title", inputTitleValue);
				formData.append("category", inputCategoryValue);
				formData.append("image", file);

			

				fetch(apiUrlWorks, {
								method: "POST",
								headers: {
									Authorization : "Bearer " + tokenUserDelete,
									"Content-Type" : "multipart/form-data"
								},
								body: formData
							})
							.then(response => response.json())
							.then(data => {
								console.log(data);
							}).catch(error => {
								console.log("Erreur:", error);
							});
						});
						
	

	addPhotosButton.onclick = function() {
		dynamicDivDeletePhotos.style.display = "none";
		dynamicDivAddPhotos.style.display = "block";
		addPhotosButton.style.display = "none";
		validateButton.style.display = "block";
		backButton.style.display = "block";
	}

	backButton.onclick = function() {
		dynamicDivDeletePhotos.style.display = "block";
		dynamicDivAddPhotos.style.display = "none";
		addPhotosButton.style.display = "block";
		validateButton.style.display = "none";
		backButton.style.display = "none";
	}



	inputTitle.addEventListener("input", validateFields);
	inputImage.addEventListener("input", validateFields);
	inputCategory.addEventListener("input", validateFields);

	function validateFields() {
		if (inputTitle.value != "" && inputImage.value != "" && inputCategory.value != "") {
			validateButton.style.backgroundColor = "var(--main-color)";
			validateButton.style.pointerEvents = "fill";
		} else {
			validateButton.style.backgroundColor = ""; 
			validateButton.style.pointerEvents = ""; 
		}
	}


	function showGallery() {
	fetch(apiUrlWorks).then(response => {
		if (!response.ok) {
			throw new Error('Erreur lors de la récupération des données -> works');
			}
		return response.json();
	})
		.then(data => {
			const showGalleryPhotos = arr => {
			let outputGalleryForDelete = "";
			arr.forEach(({id, title, categoryId, imageUrl}) =>{
				outputGalleryForDelete += `
					<div class="imageFromGallery">
						<button class="deleteIcon" onclick="deletePhoto(${id})"><i class="fa fa-trash-can"></i></button>
						<img src="${imageUrl}" alt="${title}">
					</div>
				`;
			});
			document.getElementById("divForGallery").innerHTML = outputGalleryForDelete;
			};
			showGalleryPhotos(data);
		}).catch(error => {
			console.error('Erreur:', error);
		});
	}
		
		
		function deletePhoto(id) {
			const apiUrlWorksDelete = 'http://localhost:5678/api/works/'+id;
			fetch(apiUrlWorksDelete, {
				method: 'DELETE',
				headers : {
					"Accept" : "application/json",
					"cache" : "no-cache",
					"Authorization" : "Bearer "+tokenUserDelete
				}
			}).catch(error => {
				console.error('Erreur:', error);
			});
			showGallery();
		}
		

	fetch(apiUrlFilters)

		.then(response => {
			if (!response.ok) {
				throw new Error('Erreur lors de la récupération des données -> categories')
			}
			return response.json();
		})

		.then(data => {
			const showFilters = arr => {
				let outputFilters = `
				<div class="filter-case">
					<input type="radio" id="all" name="filters-name" checked onclick="filterShows(0)">
					<label for="all">Tous</label>
				</div>
				`;
				arr.forEach(({ id, name}) => {
					outputFilters += `
					<div class="filter-case">
						<input type="radio" id="${name}" name="filters-name" onclick="filterShows(${id})">
						<label for="${name}">${name}</label>
					</div>
					`;
				});
				document.getElementById("filters").innerHTML = outputFilters;
			};
			showFilters(data);
		})
		.catch(error => {
			console.error('Erreur:', error);
		  });


	let outputWorks = "";

	fetch(apiUrlWorks)
	.then(response => {
		if (!response.ok) {
		throw new Error('Erreur lors de la récupération des données -> works');
		}
		return response.json();
	})
	.then(data => {
			window.allProjects = data;
			filterShows(0);
		})
	.catch(error => {
		console.error('Erreur:', error);
	});

	function filterShows(categoryId) {
		let filterShows = window.allProjects;

		if(categoryId > 0) {
			filterShows = filterShows.filter(show => show.categoryId === categoryId);
		}
		displayShows(filterShows);
	}

	function displayShows(shows) {
		let outputWorks = "";
		shows.forEach(({id, title, categoryId, imageUrl}) => {
			outputWorks += `
				<figure id="${id}">
					<img src="${imageUrl}" alt="${title}">
					<figcaption>${title}</figcaption>
				</figure>
			`
		})
		document.getElementById("items").innerHTML = outputWorks;
	}
</script>

<script>
	let	tokenUser = sessionStorage.getItem('token');

	let outputUserHeader = "";

	if(tokenUser !== null) {
		outputUserHeader += `
			<div class="header-modification">
				<p><i class="fa fa-pen-to-square"></i> Mode édition</p>
			</div>
		`
	} else {
		outputUserHeader = "";
	}
	document.getElementById("outputUserHeader_id").innerHTML = outputUserHeader;

	if(tokenUser !== null) {
		let outputModifyBtn = "";
		if(tokenUser !== null) {
			outputModifyBtn +=`
				<span class="openModalButton" id="btnOpen"><i class="fa fa-pen-to-square"></i> modifier</span>
			`
		} else {
			outputModifyBtn = "";
		}
		document.getElementById("modifierBtnId").innerHTML = outputModifyBtn;

		
		let btnOpen = document.getElementById("btnOpen");
		let modalModify = document.getElementById("modalModify");
		let htmlOverflow = document.getElementsByTagName("html")[0];
		let close = document.getElementsByClassName("close")[0];

		btnOpen.onclick = function() {
			modalModify.style.display = "block";
			htmlOverflow.style.overflow = "hidden";
		}

		close.onclick = function() {
			modalModify.style.display = "none";
			htmlOverflow.style.overflow = "auto";
		}

		window.addEventListener("click", function(event) {
			if (event.target == modalModify) {
				modalModify.style.display = "none";
				htmlOverflow.style.overflow = "auto";
			}
		});
	}

	
	validateFields();
	showGallery();
</script>
</body>
</html>
